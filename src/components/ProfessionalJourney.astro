---
import { jobs } from '../data/jobs';

// Assign colors dynamically to jobs (repeating pattern if more jobs than colors)
// Define color schemes with background and text colors
const colorSchemes = [
    { bg: 'bg-red-500', text: 'text-white', border: 'border-white' },
    { bg: 'bg-blue-500', text: 'text-white', border: 'border-white' },
    { bg: 'bg-yellow-400', text: 'text-black', border: 'border-black' },
    { bg: 'bg-green-400', text: 'text-black', border: 'border-black' },
    { bg: 'bg-black', text: 'text-white', border: 'border-white' },
];

const jobsWithColors = jobs.map((job, i) => ({
    ...job,
    theme: colorSchemes[i % colorSchemes.length],
}));
---

<section
    class="py-20 bg-purple/10 border-t-[3px] border-b-[3px] border-black overflow-hidden relative"
>
    <div class="max-w-4xl mx-auto px-4 relative z-10">
        <h2 class="text-5xl font-comic-heading text-center mb-20 relative">
            <span
                class="bg-white px-6 py-2 border-[3px] border-black shadow-[6px_6px_0_0_#000] inline-block -rotate-1 relative"
            >
                Professional Journey
                <span
                    class="absolute -top-6 -right-8 rotate-12 bg-yellow-300 text-black text-xs font-bold px-2 py-1 border-2 border-black"
                >
                    FLIP A CARD!
                </span>
            </span>
        </h2>

        <div
            class="relative space-y-16 before:absolute before:inset-0 before:ml-5 before:md:ml-[50%] before:-translate-x-px before:h-full before:w-[3px] before:bg-black before:border-r-[1px] before:border-dashed before:border-gray-400 before:-z-10"
        >
            {
                jobsWithColors.map((job, index) => (
                    <div
                        class={`relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group ${index % 2 === 0 ? 'md:flex-row-reverse' : ''}`}
                    >
                        {/* Timeline Dot (Comic style) */}
                        <div class="absolute left-0 md:left-1/2 w-10 h-10 bg-white border-[3px] border-black rounded-full z-10 -translate-x-1.5 md:-translate-x-1/2 flex items-center justify-center shadow-[2px_2px_0_0_#000] group-hover:scale-110 transition-transform">
                            <div
                                class={`w-4 h-4 rounded-full ${job.theme.bg}`}
                            />
                        </div>

                        {/* Flip Card Container */}
                        <div
                            class="ml-16 md:ml-0 md:w-[45%] h-[300px] w-full perspective-1000 cursor-pointer flip-card-container"
                            data-index={index}
                        >
                            <div class="flip-card-inner relative w-full h-full transition-transform duration-700 preserve-3d">
                                {/* FRONT FACE - Cream/Paper Background */}
                                {/* FRONT FACE - Image Card */}
                                <div class="flip-card-front absolute w-full h-full backface-hidden">
                                    <div
                                        class={`h-full w-full bg-white border-[3px] border-black shadow-[8px_8px_0_0_#000] relative group hover:scale-[1.02] transition-transform`}
                                    >
                                        {/* Full Height Image Placeholder */}
                                        <div class="w-full h-full bg-gray-100 flex items-center justify-center relative overflow-hidden">
                                            {/* Pattern or Image */}
                                            <div
                                                class="absolute inset-0 opacity-10"
                                                style="background-image: radial-gradient(#000 1px, transparent 1px); background-size: 10px 10px;"
                                            />
                                            <span class="font-comic-body text-gray-400 transform -rotate-2 text-xl font-bold opacity-50">
                                                PROJECT IMAGE
                                            </span>
                                        </div>

                                        {/* Date Sticker - Conditionally Positioned */}
                                        <div
                                            class={`absolute ${index % 2 === 0 ? '-right-6 -top-4 rotate-6' : '-left-6 -top-4 -rotate-6'} z-20`}
                                        >
                                            <span
                                                class={`inline-block px-4 py-2 text-sm font-bold border-[3px] border-black ${job.theme.bg} ${job.theme.text} shadow-[4px_4px_0_0_#000]`}
                                            >
                                                {job.period}
                                            </span>
                                        </div>

                                        {/* Bottom Content Overlay */}
                                        <div class="absolute bottom-0 left-0 right-0 bg-white border-t-[3px] border-black p-4">
                                            <h3 class="font-comic-heading text-xl md:text-2xl leading-none mb-1 uppercase text-black line-clamp-1">
                                                {job.role}
                                            </h3>
                                            <div class="font-bold text-sm text-black/80">
                                                @ {job.company}
                                            </div>
                                            <div class="absolute bottom-4 right-4 text-2xl animate-pulse text-black">
                                                â†»
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* BACK FACE - Solid Theme Color */}
                                <div class="flip-card-back absolute w-full h-full backface-hidden rotate-y-180">
                                    <div
                                        class={`h-full w-full ${job.theme.bg} border-[3px] border-black shadow-[8px_8px_0_0_#000] p-6 overflow-y-auto custom-scrollbar ${index % 2 === 0 ? 'rotate-1' : '-rotate-1'}`}
                                    >
                                        <h4
                                            class={`font-comic-heading text-xl border-b-2 ${job.theme.border} mb-3 pb-1 ${job.theme.text}`}
                                        >
                                            Mission Details
                                        </h4>
                                        <ul
                                            class={`list-none space-y-2 font-comic-body text-sm ${job.theme.text}`}
                                        >
                                            {job.description.map((desc) => (
                                                <li class="relative pl-4">
                                                    <span
                                                        class={`absolute left-0 top-1.5 w-1.5 h-1.5 ${job.theme.text.includes('white') ? 'bg-white' : 'bg-black'} rounded-full`}
                                                    />
                                                    {desc}
                                                </li>
                                            ))}
                                        </ul>
                                        <div
                                            class={`mt-4 pt-2 border-t-2 ${job.theme.border} flex flex-wrap gap-1`}
                                        >
                                            {job.techStack?.Frontend.slice(
                                                0,
                                                4,
                                            ).map((tech) => (
                                                <span
                                                    class={`text-[10px] uppercase font-bold border ${job.theme.border} px-1 bg-white/20 ${job.theme.text}`}
                                                >
                                                    {tech}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                ))
            }
        </div>
    </div>

    <style>
        .perspective-1000 {
            perspective: 1000px;
        }
        .preserve-3d {
            transform-style: preserve-3d;
        }
        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        .rotate-y-180 {
            transform: rotateY(180deg);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #000;
        }

        /* Comic pattern removed for solid color look */
        .comic-pattern {
            background-image: none;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }
    </style>

    <script>
        import { gsap } from 'gsap';

        // Initialize local state from global
        // @ts-ignore
        let isSoundEnabled = window.SOUND_ENABLED;

        // Better page flip sound
        const flipSound = new Audio(
            'https://www.soundjay.com/books/sounds/page-flip-01a.mp3',
        );
        flipSound.volume = 0.5;

        // Listen for global sound toggle
        window.addEventListener('sound-toggle', (e) => {
            // @ts-ignore
            isSoundEnabled = e.detail;
        });

        const cards = document.querySelectorAll('.flip-card-container');

        cards.forEach((card) => {
            const inner = card.querySelector('.flip-card-inner');
            let isFlipped = false;

            card.addEventListener('click', () => {
                if (!isFlipped) {
                    gsap.to(inner, {
                        rotateY: 180,
                        duration: 0.8,
                        ease: 'back.out(1.2)',
                    });
                    // Play sound
                    if (isSoundEnabled) {
                        flipSound.currentTime = 0;
                        flipSound
                            .play()
                            .catch((e) => console.log('Audio play failed', e));
                    }
                } else {
                    gsap.to(inner, {
                        rotateY: 0,
                        duration: 0.6,
                        ease: 'power2.out',
                    });
                    // Play sound
                    if (isSoundEnabled) {
                        flipSound.currentTime = 0;
                        flipSound
                            .play()
                            .catch((e) => console.log('Audio play failed', e));
                    }
                }
                isFlipped = !isFlipped;
            });
        });
    </script>
</section>
